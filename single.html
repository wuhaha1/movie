<!DOCTYPE HTML>
<html>
<head>
<title>Single</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Movie_store Responsive web template, Bootstrap Web Templates, Flat Web Templates, Andriod Compatible web template, 
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<!-- start plugins -->
<link rel="stylesheet" href="css/plugins/sweetalert/sweetalert.css"/>
</head>
<body>
<div class="container">
	<div class="container_wrap">
		<div class="header_top">
		    <div class="col-sm-3 logo"><a href="index.html"><img src="images/logo.png" alt=""/></a></div>
		    <div class="col-sm-6 nav">
			  <ul>
				 <li> <span class="simptip-position-bottom simptip-movable" data-tooltip="comic"><a href="index.html"> </a></span></li>
				 <li><span class="simptip-position-bottom simptip-movable" data-tooltip="movie"><a href="movie.html"> </a> </span></li>
				 <li><span class="simptip-position-bottom simptip-movable" data-tooltip="video"><a href="movie.html"> </a></span></li>
				 <li><span class="simptip-position-bottom simptip-movable" data-tooltip="game"><a href="movie.html"> </a></span></li>
				 <li><span class="simptip-position-bottom simptip-movable" data-tooltip="tv"><a href="movie.html"> </a></span></li>
				 <li><span class="simptip-position-bottom simptip-movable" data-tooltip="more"><a href="movie.html"> </a></span></li>
			 </ul>
			</div>
			<div class="col-sm-3 header_right">
			   <ul class="header_right_box">
				 <li><img src="images/p1.png" alt=""/></li>
				 <li><p><a></a></p></li>
				 <li class="last"><a class="log">退出 </a></li>
				 <div class="clearfix"> </div>
			   </ul>
			</div>
			<div class="clearfix"> </div>
	      </div>
	   <div class="content">
      	   <div class="movie_top">
      	         <div class="col-md-9 movie_box">
                        <div class="grid images_3_of_2">
                        	<div class="movie_image">
                                <span class="movie_rating">5.0</span>
                                <img src="images/single.jpg" class="img-responsive" alt=""/>
                            </div>
                            <div class="movie_rate">
                            	<div class="rating_desc"><p>Your Vote :</p></div>
                            	<form action="" class="sky-form">
							     <fieldset>					
								   <section>
								     <div class="rating">
										<input type="radio" name="stars-rating" id="stars-rating-5">
										<label for="stars-rating-5"><i class="icon-star"></i></label>
										<input type="radio" name="stars-rating" id="stars-rating-4">
										<label for="stars-rating-4"><i class="icon-star"></i></label>
										<input type="radio" name="stars-rating" id="stars-rating-3">
										<label for="stars-rating-3"><i class="icon-star"></i></label>
										<input type="radio" name="stars-rating" id="stars-rating-2">
										<label for="stars-rating-2"><i class="icon-star"></i></label>
										<input type="radio" name="stars-rating" id="stars-rating-1">
										<label for="stars-rating-1"><i class="icon-star"></i></label>
									 </div>
								  </section>
							    </fieldset>
						  	   </form>
						  	   <div class="clearfix"> </div>
                            </div>
                        </div>
                        <div class="desc1 span_3_of_2">
                        	<p class="movie_option"><strong>Country: </strong><a href="#">established</a>, <a href="#">USA</a></p>
                        	<p class="movie_option"><strong>Year: </strong>2014</p>
                        	<p class="movie_option"><strong>Category: </strong><a href="#">Adventure</a>, <a href="#">Fantazy</a></p>
                        	<p class="movie_option"><strong>Release date: </strong>December 12, 2014</p>
                        	<p class="movie_option"><strong>Director: </strong><a href="#">suffered </a></p>
                        	<p class="movie_option"><strong>Actors: </strong><a href="#">anything</a>, <a href="#">Lorem Ipsum</a>, <a href="#" discovered</a>, <a href="#"> Virginia</a>, <a href="#"> Virginia</a>, <a href="#">variations</a>, <a href="#">variations</a>, <a href="#">variations</a>, <a href="#"> Virginia</a> <a href="#">...</a></p>
                            <p class="movie_option"><strong>Age restriction: </strong>13</p> 
                            <div class="down_btn"><a class="btn1" href="#"><span> </span>Download</a></div>
                         </div>
                        <div class="clearfix"> </div>
                        <p class="m_4">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text. All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet.</p>
		                <form method="post" action="contact-post.html">
							<div class="to">
		                     	<input type="text" class="text" value="Name" onFocus="this.value = '';" onBlur="if (this.value == '') {this.value = 'Name';}">
							 	<input type="text" class="text" value="Email" onFocus="this.value = '';" onBlur="if (this.value == '') {this.value = 'Email';}" style="margin-left:3%">
							</div>
							<div class="text">
			                   <textarea id="content" value="Message:" onFocus="this.value = '';" onBlur="if (this.value == '') {this.value = 'Message';}">Message:</textarea>
			                </div>
			                <div class="form-submit1">
					           <input name="button" type="button" id="send" value="发送消息"><br>
					        </div>
							<div class="clearfix"></div>
                 		</form>
		                <div class="single">
		                <h1>10 Comments</h1>

		                <ul class="single_list" data-bind="foreach:viewModel.data">
					        <li>
					            <div class="preview"><a href="#"><img src="images/2.jpg" class="img-responsive" alt=""></a></div>
					            <div class="data">
					                <div class="title">
                                        <span data-bind="text:$data.attributes.name"></span>
                                        <span class="time" data-bind="text:$data.createdAt"></span>
                                        <a href="#" data-bind="attr:{'cId': $data.cid}">回复</a></div>
					                <p data-bind="text:$data.attributes.content"></p>
					            </div>
					            <div class="clearfix"></div>
					        </li>

			  			</ul>
                      </div>
                      </div>
                      <div class="col-md-3">
                      	<div class="movie_img"><div class="grid_2">
							<img src="images/pic6.jpg" class="img-responsive" alt="">
							<div class="caption1">
									<ul class="list_5 list_7">
							    		<li><i class="icon5"> </i><p>3,548</p></li>
							    	</ul>
							    	<i class="icon4 icon6 icon7"> </i>
							    	<p class="m_3">Guardians of the Galaxy</p>
							</div>
						    </div>
						   </div>
                      	  <div class="grid_2 col_1">
							<img src="images/pic2.jpg" class="img-responsive" alt="">
							<div class="caption1">
								<ul class="list_3 list_7">
						    		<li><i class="icon5"> </i><p>3,548</p></li>
						    	</ul>
						    	<i class="icon4 icon7"> </i>
						    	<p class="m_3">Guardians of the Galaxy</p>
							</div>
						   </div>
						    <div class="grid_2 col_1">
							<img src="images/pic9.jpg" class="img-responsive" alt="">
							<div class="caption1">
								<ul class="list_3 list_7">
						    		<li><i class="icon5"> </i><p>3,548</p></li>
						    	</ul>
						    	<i class="icon4 icon7"> </i>
						    	<p class="m_3">Guardians of the Galaxy</p>
							</div>
						   </div>
		               </div> 
                      <div class="clearfix"> </div>
                  </div>
           </div>
    </div>
</div>
<div class="container"> 
 <footer id="footer">
 	<div id="footer-3d">
		<div class="gp-container">
			<span class="first-widget-bend"> </span>
		</div>		
	</div>
    <div id="footer-widgets" class="gp-footer-larger-first-col">
		<div class="gp-container">
            <div class="footer-widget footer-1">
            	<div class="wpb_wrapper">
					<img src="images/f_logo.png" alt=""/>
				</div> 
	          <br>
	          <p>It is a long established fact that a reader will be distracted by the readable content of a page.</p>
			  <p class="text">There are many variations of passages of Lorem Ipsum available, but the majority have suffered.</p>
			 </div>
			 <div class="footer_box">
			  <div class="col_1_of_3 span_1_of_3">
					<h3>Categories</h3>
					<ul class="first">
						<li><a href="#">Dance</a></li>
						<li><a href="#">History</a></li>
						<li><a href="#">Specials</a></li>
					</ul>
		     </div>
		     <div class="col_1_of_3 span_1_of_3">
					<h3>Information</h3>
					<ul class="first">
						<li><a href="#">New products</a></li>
						<li><a href="#">top sellers</a></li>
						<li><a href="#">Specials</a></li>
					</ul>
		     </div>
		     <div class="col_1_of_3 span_1_of_3">
					<h3>Follow Us</h3>
					<ul class="first">
						<li><a href="#">Facebook</a></li>
						<li><a href="#">Twitter</a></li>
						<li><a href="#">Youtube</a></li>
					</ul>
					<div class="copy">
				      
			        </div>
		     </div>
		    <div class="clearfix"> </div>
	        </div>
	        <div class="clearfix"> </div>
		</div>
	</div>
  </footer>
</div>
<div id="loginModal" class="modal hide fade in" style="display: none; ">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>This is a Modal Heading</h3>
    </div>
    <div class="modal-body">
        <h4>Text in a modal</h4>
        <p>You can add some text here.</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn btn-success"></a>
        <a href="#" class="btn" data-dismiss="modal"></a>
    </div>
</div>
<script src="js/jquery-2.1.1.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/bmob/bmob-min.js"></script>
<script src="js/bmob/bmobSocketIo-min.js"></script>
<script src="js/plugins/ko/knockout-3.4.0.js"></script>
<script src="js/plugins/sweetalert/sweetalert.min.js"></script>
<script>
    var loginName = $.cookie('username'); // 读取 cookie
    if(loginName){
        $('.log').text('退出');
        $('.header_right_box li p a').text(loginName);
    }else{
        $('.log').text('登录').attr('href','login.html');
    }
    $(function(){
        $('.log').click(function(){
            if($(this).text() == '退出'){
                swal({
                    title: "您确定要退出吗！",
                    text: "",
                    type: "warning",
                    showCancelButton: true,
                    closeOnConfirm: false,
                    cancelButtonText: '取消',
                    confirmButtonText: "退出",
                    confirmButtonColor: "#ec6c62"
                }, function(){
                    $.cookie('username', '', { expires: -1 }); // 删除 cookie
                    window.location.reload();
                });
            }
        });
    });

</script>

<script type="text/javascript">
    //服务器
    BmobSocketIo.initialize("02448429eba5a16fbd1ecc31efb745ae");
    Bmob.initialize("02448429eba5a16fbd1ecc31efb745ae", "0bd2b88334ff05852ff6454ea3aeecc4");
    var viewModel = {};
    viewModel.data = ko.observableArray();
    viewModel.initData = function() {
        var Chat = Bmob.Object.extend("Chat");
        var chat = new Bmob.Query(Chat);
        chat.select('name','content');
        chat.find().then(function(results){
            if(results.length)
            $('.single h1').text(results.length+' Comments');
            viewModel.data(results);
        });
    }();
    ko.applyBindings(viewModel);

    //发送消息
    $("#send").click(function(){
        if($.cookie('username')){
            sendMsg();
        }else{
            swal({
                title: "您还没有登录！",
                text: "",
                type: "warning",
                showCancelButton: true,
                closeOnConfirm: false,
                cancelButtonText: '暂不登录',
                confirmButtonText: "马上登录",
                confirmButtonColor: "#ec6c62"
            }, function(){
                    location.href='login.html';
            });
        }
    });
    //通过“回车”提交聊天信息
    $('#content').keydown(function(e) {
        if (e.keyCode === 13) {
            if($.cookie('username')){
                sendMsg();
            }else{
                swal({
                    title: "您还没有登录！",
                    text: "",
                    type: "warning",
                    showCancelButton: true,
                    closeOnConfirm: false,
                    cancelButtonText: '暂不登录',
                    confirmButtonText: "马上登录",
                    confirmButtonColor: "#ec6c62"
                }, function(){
                    location.href='login.html';
                });
            }
        }
    });

    //初始连接socket.io服务器后，需要监听的事件都写在这个函数内
    BmobSocketIo.onInitListen = function() {
        //订阅GameScore表的数据更新事件
        BmobSocketIo.updateTable("Chat");
    };

    //监听服务器返回的更新表的数据
    BmobSocketIo.onUpdateTable = function(tablename,data) {

        if( tablename=="Chat" ) {
            // alert(tablename);
            var content=$(".single_list");
            var oneComment = '<li><div class="preview"><a href="#"><img src="images/3.jpg" class="img-responsive" alt=""></a></div>' +
                    '<div class="data"><div class="title">'+ data.name+ '<span class="time">'+ data.createdAt+'</span><a href="#">回复</a></div>' +
                    '<p>'+data.content+'</p></div><div class="clearfix"></div></li>';
            content.html(content.html()+oneComment);
            swal({
                title: "发送成功！",
                text: "1秒后自动关闭",
                type: "success",
                timer: 1200
            });
            //设置评论数量
            $('.single h1').text($('.single_list li').length+' Comments');
        }
    };
    function sendMsg(){
        var Chat = Bmob.Object.extend("Chat");
        var chat = new Chat();
        chat.set("name", $.cookie('username'));
        chat.set("content", $("#content").val());
        chat.save(null, {
            success: function(object) {
            },
            error: function(model, error) {
            }
        });
    }
    //通过“回车”提交聊天信息
    /*$('#name').keydown(function(e) {
        if (e.keyCode === 13) {
            sendMsg();
        }
    });*/

</script>

</body>
</html>